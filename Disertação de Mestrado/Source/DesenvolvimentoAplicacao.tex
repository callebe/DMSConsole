
Nesta etapa do trabalho é desenvolvido o \textit{software} implementado no Raspberry Pi Zero W, para o novo modelo de console de indicadores de destino da DMS.  Este \textit{software} será aqui denominado DMSConsole versão 1.0, e será basicamente desenvolvido na linguagem de programação C++, utilizando algumas bibliotecas nativas de sistemas operacionais que utilizam o Kernel Linux e outras que são especificas para \textit{hardware} Raspberry Pi. Portanto o \textit{software} desenvolvido aqui pode ser compilado em diferentes modelos de \textit{hardware} Raspberry Pi, apenas necessitando de pequenos ajustes nas portas utilizadas. 

O desempenho do DMSConsole é um elemento crucial nesta aplicação, pois o tempo de execução de tarefas do \textit{software} pode interferir na execução das rotinas de comunicação dos painéis, comprometendo o correto funcionamento dos mesmo. O tempo de resposta á requisições feitas pelo usuário através do \textit{Display Touchscreen} e o tempo de inicialização do console são parâmetros que podem comprometer a experiência do usuário, e de mesmo modo dependem do desempenho da aplicação nas diferentes tarefas executadas. Assim utilizando os recursos que a linguagem C++ oferece, o desenvolvimento de cada função da aplicação DMSConsole é feita visando a otimização de recursos computacionais.   

\section{Gerenciador XML}

Como foi visto na Seção (\ref{sec:GestorDeIndicacaoDeDestinos}) a aplicação GID a partir das informações inseridas pelo usuário, gera um conjunto de arquivos binários com as informações a serem inseridas no console, e consequentemente enviadas aos painéis eletrônicos. Este conjunto de dados gerados possui uma sintaxe própria, que somente a aplicação GID gera e somente o console do Indicador de Destino da DMS consegue ler e identificar a estrutura dos dados. Com a intenção de tornar o arquivo fonte de dados para Indicadores de Destino mais padronizado e portável para diferentes versões de console, será utilizado o XML como padrão de descrição de dados. Assim será possível gerar fonte de dados, para os Indicadores de Destino, através de qualquer aplicação de criação de arquivos XML, utilizando apenas a estrutura de dados apresentada na Figura (\ref{fig:EstruturaDeDados}).  

O XML, ou Linguagem de Marcação Extensível (\textit{Extensible Markup Language}), é um formato para criação de dados organizados de forma hierárquica, recomendado pelo W3C (\textit{World Wide Web Consortium}). O XML é uma combinação entre o flexibilidade que SGML, ou \textit{Standard Generalized Markup Language} e a simplicidade visual que o HTML, ou \textit{HyperText Markup Language} oferecem. Assim o XML oferece:  simplicidade e legibilidade dos dados, tanto para usuários quanto para \textit{softwares}; Flexibilidade, possibilitando a criação de \textit{tags} ilimitadas; interligação facilitada entre banco de dados e uma boa estruturação \cite{Bray}.

A estrutura de dados do GID, apresentada na Figura (\ref{fig:EstruturaDeDados}), é constituída por $n$ elementos 'Linha', que serão designados no padrão XML como 'Line', que estão contidos dentro de um conjunto de dados fontes para os indicadores de destino. Como padrão da DMS, todos conjuntos de dados de uma 'Linha' deve estar associada a um conjunto de painéis, e este conjunto associado ao elemento raiz GID. Assim é criado um elemento 'GID' (Gestor de Indicadores de Destino), o qual pode possuir $n$ elementos 'Group', os quais representam grupos de painéis eletrônicos que estão a ser geridos. Estes grupos são elementos que contem os elementos 'Line', com seus atributos e seus elementos relacionados. Logo como exemplo, considerando um arquivo XML que contém informação a cerca de uma linha de autocarros denominada 'Aliados-Viso' de número 201, o qual possuí como destinos possíveis o 'Planetário' ou a rua 'PR. D. JOÃO I'. E que exista apenas um painel de dimensões 16x112 pixeis, onde as informações devam ser mostradas em uma página de configuração número da linha + nome do destino, com espaço de 2 pixeis entre o número e nome, e com 1 pixel entre caracteres do nome. O arquivo XML para este GID especifico é dado da seguinte forma: 

\vspace{3mm}
\lstset{style=mystyle}
\begin{lstlisting}
<GID version="1.1">
  <Group ID="1">
    <Line ID="201" Name="ALIADOS-VISO">
      <Destination ID="1" Name="PLANETÁRIO" Return="1">
        <Panel Lines="16" Columns="112">
          <Page ID="1" SBC="1" SBNAndC="2" PT="15">
            <Number Effect="None" Align="Left" Font="16x9">
              201
            </Number>
            <Text Effect="None" Align="Left" Font="5x5">
              PLANETÁRIO
            </Text>
          </Page>
        </Panel>
      </Destination>
      <Destination ID="2" Name="PR. D. JOÃO I" Return="2">
        <Panel Lines="16" Columns="112">
          <Page ID="6" SBC="1" SBNAndC="2" PT="15">
            <Number Effect="None" Align="Left" Font="12x7">
              201
            </Number>
            <Text Effect="None" Align="Left" Font="5x5">
              PR. D. JOÃO I
            </Text>
          </Page>
        </Panel>
      </Destination>
    </Line>
  </Group>
</GID>
\end{lstlisting}
\label{code:XML}
\vspace{3mm}

O \textit{software} DMSConsole deve ser capaz de ler um arquivo XML com as informações da estrutura de dado GID, como apresentado em (\ref{code:XML}), e ainda quando necessário criar um arquivo XML semelhante. O DMSConsole deve possibilitar ao usuário criar, através da interface de usuário, um arquivo XML com a estrutura de dados GID, para servir de fonte para os dados apresentados nos painéis. Existem varias bibliotecas prontas, em C++, para leitura e criação de arquivos XML, porém para tornam as funções de leitura e criação mais eficientes, e reduzir a complexabilidade do código, fora desenvolvido uma biblioteca própria nomeada GIDxml.

As funções de leitura e criação da biblioteca GIDxml utilizam uma estrutura de dados semelhante a GID, porém com um sistema de alocação dinâmica de memória. A alocação dinâmica permite uma melhor gestão e maior capacidade de uso da memória da aplicação, tornando possível a aplicação ler arquivos XML de maior volume.    

\section{Gerenciador Interface}



\section{Gerenciador Painéis}

Os painéis eletrônicos utilizados nos indicadores de destino da DMS possuem um protocolo de comunicação próprio desenvolvido pela DMS, o qual é chamado de protocolo LDESIGN. Este protocolo possibilita que sejam enviados informação de controle e notificação para qualquer dispositivo que integra a rede de comunicação dos indicadores. A rede de comunicação dos indicadores de destino é normalmente composta por um console, que funciona no modo \textit{Master}, e até 16 painéis funcionando do modo \textit{Slave}. 

O protocolo LDESIGN é estabelecido em uma interface UART-RS485 com um \textit{Baud Rate} de 9600bps, com 8 bits de dados e 1 \textit{Stop Bit}. Neste protocolo qualquer mensagem enviada ou recebida por um dispositivo da rede segue o seguinte formato:

\vspace{5mm}
\begin{table}[H]
	\centering
	\captionsetup{width=\linewidth}
	\begin{tabular}{|c|c|l|c|}
		\hline
		\cellcolor[HTML]{000000}{\color[HTML]{FFFFFF}Ordem} & \cellcolor[HTML]{000000}{\color[HTML]{FFFFFF}Comando} & \cellcolor[HTML]{000000}{\color[HTML]{FFFFFF}Descrição} & \cellcolor[HTML]{000000}{\color[HTML]{FFFFFF}Nº bits} \\
		\hline
		1º     & \textless{}SOH\textgreater{}  & \textit{Start of heading} - 81h      & 8           \\
		\hline
		2º     & Destino                       & ID do dispositivo destino            & 8           \\
		\hline
		3º     & Origem                        & ID do dispositivo origem             & 8           \\
		\hline
		4º     & \textless{}STX\textgreater{}  & \textit{Start of text}    - 82h      & 16          \\
		\hline
		5º     & N                             & Tamanho em Bytes dos Dados + 1       & 8           \\
		\hline
		6º     & Tipo                          & Tipo de dado enviado                 & 8           \\
		\hline
		7º     & Dados                         & Dados a serem enviados               & N           \\
		\hline
		8º     & \textless{}ETX\textgreater{}  & \textit{End of Text}      - 83h      & 8           \\
		\hline
		9º     & \textless{}CHKS\textgreater{} & \textit{checksum}-soma de todos os Bytes   & 8           \\
		       &                               & da mensagem, SOH até ETX       &             \\
    	\hline
	\end{tabular}
	\caption{Formato Geral - Protocolo Geral de Comunicação LDESIGN}
	\caption*{Fonte: \cite{DMSManual}}
	\label{tab:ProtocoloComunicacaoMain}
\end{table}
\vspace{5mm}

Dentro do protocolo de comunicação LDESIGN há um conjunto de tipos de mensagem os quais possuem um alvo especifico dentro da rede de comunicação. O console dentro dessa rede é um dispositivo \textit{master} que realiza as requisições aos painéis, com mensagens console->painéis, e os painéis respondem com mensagens painel->console.

\section{Mensagens Console - Painéis}




